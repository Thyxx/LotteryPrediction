{% extends 'base.html' %}
{% block title %}Accueil · Prédictions Loterie{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
  <div>
    <h1 class="h3 mb-0">Historique et prédictions</h1>
    <p class="text-muted mb-0">Tirages enregistrés : Loto {{ counts['loto'] }}, EuroMillions {{ counts['euromillions'] }}.</p>
  </div>
  <form method="post" action="{{ url_for('main.update_data') }}">
    <button class="btn btn-primary" type="submit">Mettre à jour les données</button>
  </form>
</div>

<div class="row g-4">
  <div class="col-lg-6">
    <section class="card h-100">
      <div class="card-body">
        <h2 class="h5">Derniers tirages Loto</h2>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Tirage</th>
                <th>Numéros</th>
                <th>Chance</th>
              </tr>
            </thead>
            <tbody>
              {% for draw in loto_latest %}
              <tr>
                <td>{{ draw.draw_date.strftime('%d/%m/%Y') }}</td>
                <td>{{ draw.draw_number or '-' }}</td>
                <td>
                  {% for number in draw.numbers_list() %}
                    <span class="badge bg-secondary me-1">{{ '%02d'|format(number) }}</span>
                  {% endfor %}
                </td>
                <td><span class="badge bg-warning text-dark">{{ '%02d'|format(draw.chance_number) }}</span></td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted">Aucun tirage enregistré.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="text-end mt-3">
          <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('main.history', game='loto') }}">Voir tout l'historique</a>
        </div>
      </div>
    </section>
  </div>
  <div class="col-lg-6">
    <section class="card h-100">
      <div class="card-body">
        <h2 class="h5">Derniers tirages EuroMillions</h2>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Tirage</th>
                <th>Numéros</th>
                <th>Étoiles</th>
              </tr>
            </thead>
            <tbody>
              {% for draw in euromillions_latest %}
              <tr>
                <td>{{ draw.draw_date.strftime('%d/%m/%Y') }}</td>
                <td>{{ draw.draw_number or '-' }}</td>
                <td>
                  {% for number in draw.numbers_list() %}
                    <span class="badge bg-secondary me-1">{{ '%02d'|format(number) }}</span>
                  {% endfor %}
                </td>
                <td>
                  {% for star in draw.star_numbers_list() %}
                    <span class="badge bg-warning text-dark me-1">{{ '%02d'|format(star) }}</span>
                  {% endfor %}
                </td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted">Aucun tirage enregistré.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="text-end mt-3">
          <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('main.history', game='euromillions') }}">Voir tout l'historique</a>
        </div>
      </div>
    </section>
  </div>
</div>

<div class="row g-4 mt-1">
  <div class="col-lg-6">
    <section class="card h-100">
      <div class="card-body">
        <h2 class="h5">Prédictions Loto</h2>
        <p class="text-muted">Trois approches statistiques simples pour inspirer vos grilles.</p>
        <ul class="list-group list-group-flush">
          {% for prediction in loto_predictions %}
          <li class="list-group-item">
            <h3 class="h6 mb-2">{{ prediction.method }}</h3>
            <div>
              {% for number in prediction.main_numbers %}
                <span class="badge bg-primary me-1">{{ '%02d'|format(number) }}</span>
              {% endfor %}
              <span class="badge bg-warning text-dark ms-2">Chance : {{ '%02d'|format(prediction.extra_numbers[0]) }}</span>
            </div>
          </li>
          {% else %}
          <li class="list-group-item text-muted">Pas encore de données disponibles.</li>
          {% endfor %}
        </ul>
      </div>
    </section>
  </div>
  <div class="col-lg-6">
    <section class="card h-100">
      <div class="card-body">
        <h2 class="h5">Prédictions EuroMillions</h2>
        <p class="text-muted">Trois méthodes complémentaires basées sur l'historique enregistré.</p>
        <ul class="list-group list-group-flush">
          {% for prediction in euromillions_predictions %}
          <li class="list-group-item">
            <h3 class="h6 mb-2">{{ prediction.method }}</h3>
            <div class="mb-1">
              {% for number in prediction.main_numbers %}
                <span class="badge bg-primary me-1">{{ '%02d'|format(number) }}</span>
              {% endfor %}
            </div>
            <div>
              {% for star in prediction.extra_numbers %}
                <span class="badge bg-warning text-dark me-1">{{ '%02d'|format(star) }}</span>
              {% endfor %}
            </div>
          </li>
          {% else %}
          <li class="list-group-item text-muted">Pas encore de données disponibles.</li>
          {% endfor %}
        </ul>
      </div>
    </section>
  </div>
</div>
{% endblock %}

{% block update_info %}
  {% if last_update %}{{ last_update.strftime('%d/%m/%Y %H:%M') }}{% else %}Aucune mise à jour{% endif %}
{% endblock %}
